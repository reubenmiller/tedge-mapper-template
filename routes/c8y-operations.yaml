# yaml-language-server: $schema=../spec/schema.json
---
routes:
- name: c8y-operation-smartrest
  topic: c8y/s/ds
  preprocessor:
    type: csv
    fields:
      - msgid
      - serial

  template:
    type: jsonnet
    value: |
      {
          message: message,
          raw_message: message.payload,
          topic: 'c8y/s/ds/' + message.msgid,
      }

- name: shell-operation
  topic: c8y/s/ds/511
  preprocessor:
    type: csv
    fields:
      - msgid
      - serial
      - command

  template:
    type: jsonnet
    value: |
      {
          message: {
            command: message.command,
          },
          topic: 'tedge/operations/req/' + message.serial + '/' + 'execute_command',
      }

- name: download-config-operation
  topic: c8y/s/ds/524
  preprocessor:
    type: csv
    fields:
      - id
      - serial
      - content.url
      - content.type

  template:
    type: jsonnet
    value: |
      {
          message: message.content,
          topic: 'tedge/operations/req/' + message.serial + '/' + 'download_config',
      }

- name: firmware-update-operation
  topic: c8y/s/ds/515
  preprocessor:
    type: csv
    fields:
      - id
      - serial
      - contents.name
      - contents.version
      - contents.url

  template:
    type: jsonnet
    value: |
      {
          message: message.contents,
          topic: 'tedge/operations/req/' + message.serial + '/' + 'download_config',
      }

- name: software-update-operation
  topic: c8y/s/ds/529
  preprocessor:
    type: csv
    fields:
      - id
      - serial
      - contents.*.name
      - contents.*.version
      - contents.*.url
      - contents.*.type
      - contents.*.action

  template:
    type: jsonnet
    value: |
      {
          message: message.contents,
          topic: 'tedge/operations/req/' + message.serial + '/' + 'software_update',
      }
